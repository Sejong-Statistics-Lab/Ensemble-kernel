# 2023.11.08

## <Collaborative Work>

### ğŸŒŸCollaborative

## <Personal Work>

### â›„Nayeon

- Ensemble Kernel cross validation
    
    ì½”ë“œ í™•ì¸ì€ Ensemble-Kernel repositories
    
    - ë³€ìˆ˜ë¥¼ 1ê°œë¶€í„° ì „ì²´ ë‹¤ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ëª¨ë‘ í™•ì¸
        - Age, Sex, OS, StatusëŠ” í•„ìˆ˜ì ìœ¼ë¡œ ë“¤ì–´ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°í”„ë ˆì„ì— í•­ìƒ ë“¤ì–´ê°€ë„ë¡ ì„¤ì •\
        
        ```python
        #os, status ë¶„ë¦¬
        drop = x_train[['Age','OS','Status']]
        x_train_drop = x_train.drop(columns=['Age','OS','Status'])
        
        # ë°ì´í„°í”„ë ˆì„ì˜ ì—´ ì´ë¦„ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥
        columns = x_train_drop.columns
        
        column_groups = []
        
        for i in range(len(columns)):
            # i+1ê°œì”© ì„ íƒí•œ ëª¨ë“  ì—´ ì¡°í•©ì„ ìƒì„±
            all_column_combinations = list(combinations(columns, i+1))
        
            # ê° ì¡°í•©ì— ëŒ€í•œ ë°ì´í„°í”„ë ˆì„ì„ ìƒì„±í•˜ê³  ì¶œë ¥
            for column_combination in all_column_combinations:
                selected_columns = list(column_combination)
                sub_train1 = x_train_drop[selected_columns]
                sub_train2 = pd.concat([sub_train1, drop], axis=1)
                column_groups.append(sub_train2
        ```
        
    - ì•ì„œ ë§Œë“¤ì–´ë‘” ê°ê°ì˜ ë³€ìˆ˜ê°€ ì„ íƒëœ ëª¨ë“  ê²½ìš°ì˜ ë°ì´í„°í”„ë ˆì„ë³„ cross validation ì‹¤í–‰
        
        ```python
        num_groups = 3
        best_cindex = []
        
        for i in range(len(column_groups)):
            x_groups = []
            train = column_groups[i].sample(frac=1).reset_index(drop=True)
        
            # train dataë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
            for i in range(num_groups):
                censored = train[train['Status'] == 0]  # 0ì¸ í–‰ë§Œ ì¶”ì¶œ
                uncensored = train[train['Status'] == 1]  # 1ì¸ í–‰ë§Œ ì¶”ì¶œ
        
                group_size1 = len(censored) // num_groups
                group_size2 = len(uncensored) // num_groups
        
                if i < num_groups - 1:
                    #censoring ë¹„ìœ¨ ë§ì¶”ê¸°
                    group1 = censored.iloc[i * group_size1:(i + 1) * group_size1]
                    group2 = uncensored.iloc[i * group_size2:(i + 1) * group_size2]
        
                    group = pd.concat([group1, group2], ignore_index=True)
                else:
                    group1 = censored.iloc[i * group_size1:]
                    group2 = uncensored.iloc[i * group_size2:]
        
                    group = pd.concat([group1, group2], ignore_index=True)
            
                x_groups.append(group)
            
            cindex=[]
        
            for i in range(len(x_groups)):
        
                temp = []
                for j in range(len(x_groups)):
                    if i != j:
                        temp.append(x_groups[j])
                #train = train data(ë“±ë¶„í•œ ê²ƒ ì¤‘ 1ê°œë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€)
                train=pd.concat(temp)
        
                #validation = validation data(ë“±ë¶„í•œ ê²ƒ ì¤‘ 1ê°œ)
                validation = x_groups[i]
        
                train_target=train[['Status','OS']]
                test_target=validation[['Status','OS']]
        
                train_y=prepare_response_variable(train_target)
                test_y=prepare_response_variable(test_target)
                #dataì •ì˜ -> train, validation, train_y, test_y
        
                result = C_index_fastKernelSurvivalSVM(train, train_y, validation, test_y, param_grid, keywords = ['Age'], drop=False, coef_drop=None)
            
                cindex.append(result[1])
                #print(result[1]) #ìƒëµ ê°€ëŠ¥
            
            best_cindex.append(np.mean(cindex))
        ```
        
    - ì•ì„œë‚˜ì˜¨ ëª¨ë“  validation cindexê°’ì„ best cindex ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
        - ì´ë•Œ ê°€ì¥ í° ê°’ì„ ê°€ì§€ëŠ” ë°ì´í„°í”„ë ˆì„ í™•ì¸
        - ì„ íƒëœ ë³€ìˆ˜ë§Œì„ ê°€ì§€ê³  train, test ë°ì´í„° ì¬ì •ì˜
        - ì¬ì •ì˜í•œ ë°ì´í„°ë¥¼ ì´ìš©í•´ ì „ì²´ training ì‹¤í–‰
        
        ```python
        #best_cindex : ì„ íƒëœ ë³€ìˆ˜ë³„ ëª¨ë“  validation cindexê°’ì„ listë¡œ ì €ì¥
        #max_num : best cindexì˜ ë¦¬ìŠ¤íŠ¸ ë²ˆí˜¸
        max_num = best_cindex.index(max(best_cindex))
        
        #train_column : best cindexì˜ ì„ íƒëœ ë³€ìˆ˜
        train_column = column_groups[max_num].columns
        
        #ì„ íƒëœ ë³€ìˆ˜ë§Œì„ ê°€ì§€ê³  train, test ì¬ì •ì˜
        #x_train_re, y_train, x_test_re, y_test
        x_train_re=x_train[train_column]
        x_test_re=x_test[train_column]
        
        #result_ensemble : train cindex, test cindex, remaining variables ìˆœì„œëŒ€ë¡œ ê²°ê³¼ê°€ ì €ì¥ëœ ë¦¬ìŠ¤íŠ¸
        result_ensemble = C_index_fastKernelSurvivalSVM(x_train_re, y_train, x_test_re, y_test, param_grid, keywords = ['Age', 'Sex'], drop=False, coef_drop=None)
        ```
        

### ğŸ’ªğŸ»Beomseok